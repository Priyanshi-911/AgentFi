// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "../phase2/Permissioning.sol";

contract AgentExecutor {
    Permissioning public permissioning;

    event ActionExecuted(
        address indexed agent,
        address indexed user,
        address target,
        bytes data
    );

    constructor(address _permissioning) {
        permissioning = Permissioning(_permissioning);
    }

    function execute(
        address user,
        address target,
        bytes calldata data
    ) external {
        require(
            permissioning.isAgentApproved(user, msg.sender),
            "Agent not approved"
        );

        (bool success, ) = target.call(data);
        require(success, "Execution failed");

        emit ActionExecuted(msg.sender, user, target, data);
    }
}
